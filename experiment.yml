version: 1.0.{build}

environment:
  AWSAccessKeyId: AKIAID3FVHIKWBR3ANZQ
  AWSSecretKey:
    secure: 8uj0sWtYE4hpvs2zzkmsXzmku2ZXT8/8ArcoRsj5zdu3JPt1VGt4cGXVIrNWNvyK

install:
- nuget restore
build_script:
- msbuild "WebApplication3\WebApplication3.csproj" /verbosity:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll" /t:Package /p:PackageLocation=%APPVEYOR_BUILD_FOLDER%\myapp.zip
- appveyor PushArtifact myapp.zip -Type WebDeployPackage -DeploymentName AppDeploymentName

deploy_script:
- ps: >-
  $packageweb = $artifacts.values | Where-Object { $_.path -like '*app.zip' }
  
  $exe = "C:\Program Files (x86)\AWS Tools\Deployment Tool\awsdeploy.exe"
  
  &$exe -r "-DDeploymentPackage=$($packageweb.path)" "-DEnvironment.Name=Sample-env" "-DApplication.Name=my-startup-app" "-DRegion=eu-west-1" "-DAWSAccessKey=$env:AWSAccessKeyId" "-DAWSSecretKey=$env:AWSSecretKey" "C:\projects\WebApplication3\awsdeploy.txt"
