version: 1.0.{build}
install:
- nuget restore

environment:
  webdeploy_package: 
  username: $ilyaf3
  password:
    secure: wo3gqImLjckquy1VnmwSL/S6H1Q1m7t6iKUGcvhKrzDDTIsBB2Qd2rz6Nmz6d9i9nTT5B1ci017GElrkKdf0ow==
  

build_script:
- msbuild "WebApplication3\WebApplication3.csproj" /verbosity:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll" /t:Package /p:PackageLocation=%APPVEYOR_BUILD_FOLDER%\myapp.zip
- appveyor PushArtifact myapp.zip -Type WebDeployPackage -DeploymentName AppDeploymentName

deploy:
- provider: WebDeploy
  server: https://ilyaf3.scm.azurewebsites.net/msdeploy.axd?site=ilyaf3
  website: ilyaf3
  #website: ilyaf3/vApp1
  username: $ilyaf3
  password:
    secure: wo3gqImLjckquy1VnmwSL/S6H1Q1m7t6iKUGcvhKrzDDTIsBB2Qd2rz6Nmz6d9i9nTT5B1ci017GElrkKdf0ow==
  artifact: AppDeploymentName

 deploy_script:  
  - '"C:\Program Files (x86)\IIS\Microsoft Web Deploy V3\msdeploy.exe" -verb:sync -source:package="%webdeploy_package%" -dest:auto,ComputerName="%webdeploy_server%",UserName="%webdeploy_username%",Password="%webdeploy_password%",AuthType="Basic" -setParam:"IIS Web Application Name"="%webdeploy_site%" -allowUntrusted'
